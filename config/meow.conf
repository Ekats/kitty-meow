# kitty-meow configuration
# This file is included by kitty.conf when using kitty-meow-config
# https://github.com/Ekats/kitty-meow

# Note: current-theme.conf and font_size.conf should be included by kitty.conf
# before this file, or uncomment below if using standalone:
# include current-theme.conf
# include font_size.conf

# Zoom with Ctrl++ / Ctrl+- (persists across restarts)
map ctrl+equal combine : change_font_size all +2.0 : launch --type=background sh -c "c=$(grep -oP '[0-9.]+' ~/.config/kitty/font_size.conf); echo font_size $(echo $c + 2 | bc) > ~/.config/kitty/font_size.conf"
map ctrl+plus combine : change_font_size all +2.0 : launch --type=background sh -c "c=$(grep -oP '[0-9.]+' ~/.config/kitty/font_size.conf); echo font_size $(echo $c + 2 | bc) > ~/.config/kitty/font_size.conf"
map ctrl+kp_add combine : change_font_size all +2.0 : launch --type=background sh -c "c=$(grep -oP '[0-9.]+' ~/.config/kitty/font_size.conf); echo font_size $(echo $c + 2 | bc) > ~/.config/kitty/font_size.conf"
map ctrl+minus combine : change_font_size all -2.0 : launch --type=background sh -c "c=$(grep -oP '[0-9.]+' ~/.config/kitty/font_size.conf); echo font_size $(echo $c - 2 | bc) > ~/.config/kitty/font_size.conf"
map ctrl+kp_subtract combine : change_font_size all -2.0 : launch --type=background sh -c "c=$(grep -oP '[0-9.]+' ~/.config/kitty/font_size.conf); echo font_size $(echo $c - 2 | bc) > ~/.config/kitty/font_size.conf"
map ctrl+0 combine : change_font_size all 0 : launch --type=background sh -c "echo font_size 12.0 > ~/.config/kitty/font_size.conf"
map ctrl+kp_0 combine : change_font_size all 0 : launch --type=background sh -c "echo font_size 12.0 > ~/.config/kitty/font_size.conf"

# Enable remote control for split buttons in tab bar
allow_remote_control yes

# Enable splits layout for tab bar split buttons
enabled_layouts splits,stack,tall,fat,grid,*

# Custom tab bar with +, split, and close buttons
tab_bar_edge top
tab_bar_style custom
tab_bar_min_tabs 1
tab_bar_margin_width 0
tab_bar_margin_height 1 1
tab_bar_background #222222
tab_bar_margin_color #7f8c8d

# === Window behavior (like Konsole) ===
# Don't remember window size - use fixed size
remember_window_size no
initial_window_width 103c
initial_window_height 26c

# Scrollback buffer (100k lines)
scrollback_lines 100000

# Audio bell
enable_audio_bell yes

# === Keybindings (Konsole-style) ===
# Scroll to prompt (requires shell integration)
map shift+page_up scroll_to_prompt -1
map shift+page_down scroll_to_prompt 1
map shift+home scroll_home
map shift+end scroll_end

# Quick command: system update (Konsole: Ctrl+G)
map ctrl+g launch --type=overlay --hold bash -c "yay -Syyu; echo; echo 'Press Enter to close'; read"

# Save scrollback to log file (Ctrl+Shift+L for "Log")
# Logs saved to ~/.local/share/kitty-logs/ (keeps last 20)
map ctrl+shift+l launch --stdin-source=@screen_scrollback --type=background ~/.config/kitty/save-scrollback.sh

# === Split window management (MOUSE) ===
# Show close button on split windows
show_window_close_button yes

# Enable drag-to-resize on split borders
enable_border_drag_resize yes

# Borders for drag-to-resize
window_border_width 2pt
draw_minimal_borders yes
active_border_color #17a88b
inactive_border_color #4a4a4a

# Middle-click on split to close it (fallback for window decorations)
mouse_map middle release ungrabbed close_window

# Right-click to select/focus split (then can close with middle-click)
mouse_map right press ungrabbed mouse_select_command_output
